<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ProSHADE: src/python/pyProSHADE_symmetry.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ProSHADE
   &#160;<span id="projectnumber">0.7.6.6 (JUL 2022)</span>
   </div>
   <div id="projectbrief">Protein Shape Detection</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('py_pro_s_h_a_d_e__symmetry_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">pyProSHADE_symmetry.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="py_pro_s_h_a_d_e__symmetry_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//==================================================== Include PyBind11 header</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;pybind11/pybind11.h&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;pybind11/stl.h&gt;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;pybind11/numpy.h&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">//==================================================== Add the ProSHADE_settings and ProSHADE_run classes to the PyBind11 module</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keywordtype">void</span> add_symmetryNamespace ( pybind11::module&amp; pyProSHADE )</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;{</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">//    pyProSHADE.def                                    ( &quot;findReliableUnphasedSymmetries&quot;,</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">//    [] ( ProSHADE_settings* settings, proshade_signed verbose, proshade_signed messageShift, proshade_double tolerance ) -&gt; pybind11::array_t &lt; proshade_unsign &gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">//    {</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">//        //== Run the detection</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">//        std::vector&lt; proshade_unsign &gt; rels           = ProSHADE_internal_symmetry::findReliableUnphasedSymmetries ( &amp;settings-&gt;allDetectedCAxes, verbose, messageShift, tolerance );</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">//        </span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">//        //== Allocate memory for the numpy values</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">//        proshade_unsign* npVals                       = new proshade_unsign[static_cast&lt;unsigned int&gt; ( rels.size() )];</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">//        ProSHADE_internal_misc::checkMemoryAllocation ( npVals, __FILE__, __LINE__, __func__ );</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">//        //== Copy values</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">//        for ( proshade_unsign iter = 0; iter &lt; static_cast&lt;proshade_unsign&gt; ( rels.size() ); iter++ ) { npVals[iter] = static_cast&lt; proshade_unsign &gt; ( rels.at(iter) ); }</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">//        //== Create capsules to make sure memory is released properly from the allocating language (C++ in this case)</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">//        pybind11::capsule pyCapsuleRelSyms ( npVals, []( void *f ) { proshade_unsign* foo = reinterpret_cast&lt; proshade_unsign* &gt; ( f ); delete foo; } );</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">//        //== Copy the value</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">//        pybind11::array_t &lt; proshade_unsign &gt; retArr = pybind11::array_t&lt; proshade_unsign &gt; ( { static_cast&lt;int&gt; ( rels.size() ) },                          // Shape</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">//                                                                                              { sizeof(proshade_unsign) },                                   // C-stype strides</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">//                                                                                              npVals,                                                        // Data</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">//                                                                                              pyCapsuleRelSyms );                                            // Capsule</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">//        //== Done</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">//        return ( retArr );</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">//    }, &quot;This function checks the list of detected axes (presumably from phaseless symmetry detection) and returns the best dihedral (or cyclic, if no dihedral is found) point group, or empty vector if nothing is found.&quot;, pybind11::arg ( &quot;settings&quot; ), pybind11::arg ( &quot;verbose&quot; ), pybind11::arg ( &quot;messageShift&quot; ) = 1, pybind11::arg ( &quot;tolerance&quot; ) = 0.1 );</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    pyProSHADE.def                                    ( <span class="stringliteral">&quot;optimiseDGroupAngleFromAxesHeights&quot;</span>,</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    [] ( pybind11::array_t &lt; proshade_unsign &gt; selection, <a class="code" href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html">ProSHADE_internal_data::ProSHADE_data</a>* dataObj, <a class="code" href="class_pro_s_h_a_d_e__settings.html">ProSHADE_settings</a>* settings )</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="comment">//== Sanity check</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        pybind11::buffer_info selection_buf = selection.request();</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="keywordflow">if</span> ( selection_buf.ndim != 1 ) { std::cerr &lt;&lt; <span class="stringliteral">&quot;!!! ProSHADE PYTHON MODULE ERROR !!! The first argument to optimiseDGroupAngleFromAxesHeights() must be a 1D numpy array!&quot;</span> &lt;&lt; std::endl; exit ( EXIT_FAILURE ); }</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        if ( selection_buf.shape.at(0) != 2 ) { std::cerr &lt;&lt; <span class="stringliteral">&quot;!!! ProSHADE PYTHON MODULE ERROR !!! The first argument to optimiseDGroupAngleFromAxesHeights() must be array of length 2!&quot;</span> &lt;&lt; std::endl; exit ( EXIT_FAILURE ); }</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="comment">//== Copy data to C++ format</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        proshade_unsign* arrStart = <span class="keyword">static_cast&lt;</span> proshade_unsign* <span class="keyword">&gt;</span> ( selection_buf.ptr );</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        std::vector&lt; proshade_unsign &gt; sel;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <a class="code" href="namespace_pro_s_h_a_d_e__internal__misc.html#a16336bdf0b391c953a549d3df115d691">ProSHADE_internal_misc::addToUnsignVector</a>     ( &amp;sel, arrStart[0] );</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <a class="code" href="namespace_pro_s_h_a_d_e__internal__misc.html#a16336bdf0b391c953a549d3df115d691">ProSHADE_internal_misc::addToUnsignVector</a>     ( &amp;sel, arrStart[1] );</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="comment">//== Convert data type</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        std::vector&lt; std::vector&lt; proshade_double &gt; &gt; allCs;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        std::vector&lt; proshade_double &gt; hlpVec;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        for ( <span class="keywordtype">size_t</span> it1 = 0; it1 &lt; dataObj-&gt;<a class="code" href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html#a3704cb64f672f4edc5a7f1de2642fc44">getCyclicAxes</a>()-&gt;size(); it1++ )</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            hlpVec.clear                                  ( );</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> it2 = 0; it2 &lt; 7; it2++ ) { <a class="code" href="namespace_pro_s_h_a_d_e__internal__misc.html#a68c3eafaeea1c1873c33525f337f9d0b">ProSHADE_internal_misc::addToDoubleVector</a> ( &amp;hlpVec, dataObj-&gt;<a class="code" href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html#a3704cb64f672f4edc5a7f1de2642fc44">getCyclicAxes</a>()-&gt;at(it1)[it2] ); }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            <a class="code" href="namespace_pro_s_h_a_d_e__internal__misc.html#ad9fbf28fda3873fc511fa2000ccba86c">ProSHADE_internal_misc::addToDoubleVectorVector</a> ( &amp;allCs, hlpVec );</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="comment">//== Call the C++ function</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <a class="code" href="namespace_pro_s_h_a_d_e__internal__symmetry.html#a8b39de1c901703986cb476d8cb8cf9dc">ProSHADE_internal_symmetry::optimiseDGroupAngleFromAxesHeights</a> ( &amp;allCs, sel, dataObj, settings );</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="comment">//== Done (all changes are in the data object, so nothing needs to be passed to Python)</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        return ;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    }, <span class="stringliteral">&quot;This function takes two axes with almost dihedral angle and optimises their relative positions as well as orientation with respect to the optimal angle and the rotation function.&quot;</span>, pybind11::arg ( <span class="stringliteral">&quot;selection&quot;</span> ), pybind11::arg ( <span class="stringliteral">&quot;dataObj&quot;</span> ), pybind11::arg ( <span class="stringliteral">&quot;settings&quot;</span> ) );</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    pyProSHADE.def                                    ( <span class="stringliteral">&quot;findPointFromTranslations&quot;</span>,</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    [] ( <a class="code" href="class_pro_s_h_a_d_e__settings.html">ProSHADE_settings</a>* settings, <a class="code" href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html">ProSHADE_internal_data::ProSHADE_data</a>* dataObj, pybind11::array_t &lt; float &gt; allCs, proshade_unsign whichAxis ) -&gt; pybind11::array_t &lt; proshade_double &gt;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="comment">//== Sanity check</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        pybind11::buffer_info allCs_buf = allCs.request();</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="keywordflow">if</span> ( allCs_buf.ndim != 2 ) { std::cerr &lt;&lt; <span class="stringliteral">&quot;!!! ProSHADE PYTHON MODULE ERROR !!! The third argument to findPointFromTranslations() must be a 2D numpy array!&quot;</span> &lt;&lt; std::endl; exit ( EXIT_FAILURE ); }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="comment">//== Copy to C++ data format</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        std::vector&lt; std::vector &lt; proshade_double &gt; &gt; allCAxes;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        std::vector &lt; proshade_double &gt; hlpVec;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <span class="keywordtype">float</span>* arrStart = <span class="keyword">static_cast&lt;</span> <span class="keywordtype">float</span>* <span class="keyword">&gt;</span> ( allCs_buf.ptr );</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="keywordflow">for</span> ( proshade_unsign axIt = 0; axIt &lt; static_cast&lt; proshade_unsign &gt; ( allCs_buf.shape.at(0) ); axIt++ )</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            <span class="comment">//== Clean up</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            hlpVec.clear                              ( );</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            <span class="comment">//== Copy vals</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            <span class="keywordflow">for</span> ( proshade_unsign vIt = 0; vIt &lt; 7; vIt++ )</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                <a class="code" href="namespace_pro_s_h_a_d_e__internal__misc.html#a68c3eafaeea1c1873c33525f337f9d0b">ProSHADE_internal_misc::addToDoubleVector</a> ( &amp;hlpVec, <span class="keyword">static_cast&lt;</span> proshade_double <span class="keyword">&gt;</span> ( arrStart[(axIt*7)+vIt] ) );</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            }</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            <a class="code" href="namespace_pro_s_h_a_d_e__internal__misc.html#ad9fbf28fda3873fc511fa2000ccba86c">ProSHADE_internal_misc::addToDoubleVectorVector</a> ( &amp;allCAxes, hlpVec );</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="comment">//== Prepare all required memory</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        fftw_complex *origMap = <span class="keyword">nullptr</span>, *origCoeffs = <span class="keyword">nullptr</span>, *rotMapComplex = <span class="keyword">nullptr</span>, *rotCoeffs = <span class="keyword">nullptr</span>, *trFunc = <span class="keyword">nullptr</span>, *trFuncCoeffs = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        fftw_plan planForwardFourier, planForwardFourierRot, planReverseFourierComb;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <a class="code" href="namespace_pro_s_h_a_d_e__internal__symmetry.html#a952318f67deb547d73ae3ed62ee6d5c4">ProSHADE_internal_symmetry::allocateCentreOfMapFourierTransforms</a> ( dataObj-&gt;<a class="code" href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html#a3bc44913222e67ab861dd1e5838c1ae1">getXDim</a>(), dataObj-&gt;<a class="code" href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html#a50c884973add562558803a45991bbf19">getYDim</a>(), dataObj-&gt;<a class="code" href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html#a034af93b9152fb2db675d5632a4ebc6d">getZDim</a>(), origMap, origCoeffs, rotMapComplex, rotCoeffs, trFunc, trFuncCoeffs, &amp;planForwardFourier, &amp;planForwardFourierRot, &amp;planReverseFourierComb );</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="comment">//== Compute Fourier for the original map</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> it = 0; it &lt; static_cast&lt; size_t &gt; ( dataObj-&gt;<a class="code" href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html#a3bc44913222e67ab861dd1e5838c1ae1">getXDim</a>() * dataObj-&gt;<a class="code" href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html#a50c884973add562558803a45991bbf19">getYDim</a>() * dataObj-&gt;<a class="code" href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html#a034af93b9152fb2db675d5632a4ebc6d">getZDim</a>() ); it++ ) { origMap[it][0] = dataObj-&gt;<a class="code" href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html#afe04510c67e9dc9c19efaef8463b6e6e">getMapValue</a>( it ); origMap[it][1] = 0.0; }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        fftw_execute                                  ( planForwardFourier );</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="comment">//== Run C++ code</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        std::vector&lt; proshade_unsign &gt; axLst;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        std::vector&lt; std::vector&lt; proshade_double &gt; &gt; symElems;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <a class="code" href="namespace_pro_s_h_a_d_e__internal__misc.html#a16336bdf0b391c953a549d3df115d691">ProSHADE_internal_misc::addToUnsignVector</a>     ( &amp;axLst, whichAxis );</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        symElems                                      = dataObj-&gt;<a class="code" href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html#abb67fc1576d9375f691caf224b12a15d">getAllGroupElements</a> ( &amp;allCAxes, axLst, <span class="stringliteral">&quot;C&quot;</span>, settings-&gt;<a class="code" href="class_pro_s_h_a_d_e__settings.html#a4627b03c4064d3de15efb3ebbf57ed78">axisErrTolerance</a> );</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        std::vector&lt; proshade_double &gt; pointPos       = <a class="code" href="namespace_pro_s_h_a_d_e__internal__symmetry.html#a194544dbfe4daae5fe9300daeb98c779">ProSHADE_internal_symmetry::findPointFromTranslations</a> ( dataObj,</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                                                                                                                symElems,</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                                                                                                                origCoeffs, rotMapComplex,</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                                                                                                                rotCoeffs, planForwardFourierRot,</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                                                                                                                trFuncCoeffs, trFunc,</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                                                                                                                planReverseFourierComb );</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="comment">//== Release required memory</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <a class="code" href="namespace_pro_s_h_a_d_e__internal__symmetry.html#a4e67dc983f98cde3963b0d805f41ce30">ProSHADE_internal_symmetry::releaseCentreOfMapFourierTransforms</a> ( origMap, origCoeffs, rotMapComplex, rotCoeffs, trFunc, trFuncCoeffs, planForwardFourier, planForwardFourierRot, planReverseFourierComb );</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="comment">//== Allocate memory for the numpy values</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        proshade_double* npVals                       = <span class="keyword">new</span> proshade_double[3];</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <a class="code" href="namespace_pro_s_h_a_d_e__internal__misc.html#af556836aa9286c1571196de442a6b493">ProSHADE_internal_misc::checkMemoryAllocation</a> ( npVals, __FILE__, __LINE__, __func__ );</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="comment">//== Copy values</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keywordflow">for</span> ( proshade_unsign iter = 0; iter &lt; 3; iter++ ) { npVals[iter] = <span class="keyword">static_cast&lt;</span> proshade_double <span class="keyword">&gt;</span> ( pointPos.at(iter) ); }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="comment">//== Create capsules to make sure memory is released properly from the allocating language (C++ in this case)</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        pybind11::capsule pyCapsuleSymPoint ( npVals, []( <span class="keywordtype">void</span> *f ) { proshade_double* foo = <span class="keyword">reinterpret_cast&lt;</span> proshade_double* <span class="keyword">&gt;</span> ( f ); <span class="keyword">delete</span> foo; } );</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="comment">//== Copy the value</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        pybind11::array_t &lt; proshade_double &gt; retArr = pybind11::array_t&lt; proshade_double &gt; ( { <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span> ( 3 ) },                                    <span class="comment">// Shape</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                                                                                              { <span class="keyword">sizeof</span>(proshade_double) },                                   <span class="comment">// C-stype strides</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                                                                                              npVals,                                                        <span class="comment">// Data</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                                                                                              pyCapsuleSymPoint );                                           <span class="comment">// Capsule</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="comment">//== Done</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">return</span> ( retArr );</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    }, <span class="stringliteral">&quot;This function computes the average of optimal translations for a cyclic point group.&quot;</span>, pybind11::arg ( <span class="stringliteral">&quot;settings&quot;</span> ), pybind11::arg ( <span class="stringliteral">&quot;dataObj&quot;</span> ), pybind11::arg ( <span class="stringliteral">&quot;allCs&quot;</span> ), pybind11::arg ( <span class="stringliteral">&quot;whichAxis&quot;</span> ) );</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="anamespace_pro_s_h_a_d_e__internal__symmetry_html_a194544dbfe4daae5fe9300daeb98c779"><div class="ttname"><a href="namespace_pro_s_h_a_d_e__internal__symmetry.html#a194544dbfe4daae5fe9300daeb98c779">ProSHADE_internal_symmetry::findPointFromTranslations</a></div><div class="ttdeci">std::vector&lt; proshade_double &gt; findPointFromTranslations(ProSHADE_internal_data::ProSHADE_data *symStr, std::vector&lt; std::vector&lt; proshade_double &gt; &gt; symElems, fftw_complex *origCoeffs, fftw_complex *rotMapComplex, fftw_complex *rotCoeffs, fftw_plan planForwardFourierRot, fftw_complex *trFuncCoeffs, fftw_complex *trFunc, fftw_plan planReverseFourierComb)</div><div class="ttdoc">This function computes the average of optimal translations for a cyclic point group.</div><div class="ttdef"><b>Definition:</b> <a href="_pro_s_h_a_d_e__symmetry_8cpp_source.html#l03985">ProSHADE_symmetry.cpp:3985</a></div></div>
<div class="ttc" id="anamespace_pro_s_h_a_d_e__internal__symmetry_html_a952318f67deb547d73ae3ed62ee6d5c4"><div class="ttname"><a href="namespace_pro_s_h_a_d_e__internal__symmetry.html#a952318f67deb547d73ae3ed62ee6d5c4">ProSHADE_internal_symmetry::allocateCentreOfMapFourierTransforms</a></div><div class="ttdeci">void allocateCentreOfMapFourierTransforms(proshade_unsign xDim, proshade_unsign yDim, proshade_unsign zDim, fftw_complex *&amp;origMap, fftw_complex *&amp;origCoeffs, fftw_complex *&amp;rotMapComplex, fftw_complex *&amp;rotCoeffs, fftw_complex *&amp;trFunc, fftw_complex *&amp;trFuncCoeffs, fftw_plan *planForwardFourier, fftw_plan *planForwardFourierRot, fftw_plan *planReverseFourierComb)</div><div class="ttdoc">This function allocates the required memory for the Fourier transforms required to find the centre of...</div><div class="ttdef"><b>Definition:</b> <a href="_pro_s_h_a_d_e__symmetry_8cpp_source.html#l03841">ProSHADE_symmetry.cpp:3841</a></div></div>
<div class="ttc" id="aclass_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data_html"><div class="ttname"><a href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html">ProSHADE_internal_data::ProSHADE_data</a></div><div class="ttdoc">This class contains all inputed and derived data for a single structure.</div><div class="ttdef"><b>Definition:</b> <a href="_pro_s_h_a_d_e__data_8hpp_source.html#l00048">ProSHADE_data.hpp:49</a></div></div>
<div class="ttc" id="anamespace_pro_s_h_a_d_e__internal__symmetry_html_a8b39de1c901703986cb476d8cb8cf9dc"><div class="ttname"><a href="namespace_pro_s_h_a_d_e__internal__symmetry.html#a8b39de1c901703986cb476d8cb8cf9dc">ProSHADE_internal_symmetry::optimiseDGroupAngleFromAxesHeights</a></div><div class="ttdeci">void optimiseDGroupAngleFromAxesHeights(std::vector&lt; std::vector&lt; proshade_double &gt; &gt; *ret, ProSHADE_internal_data::ProSHADE_data *dataObj, ProSHADE_settings *settings)</div><div class="ttdoc">This function takes two axes with almost dihedral angle and optimises their relative positions as wel...</div><div class="ttdef"><b>Definition:</b> <a href="_pro_s_h_a_d_e__symmetry_8cpp_source.html#l03269">ProSHADE_symmetry.cpp:3269</a></div></div>
<div class="ttc" id="aclass_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data_html_abb67fc1576d9375f691caf224b12a15d"><div class="ttname"><a href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html#abb67fc1576d9375f691caf224b12a15d">ProSHADE_internal_data::ProSHADE_data::getAllGroupElements</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; proshade_double &gt; &gt; getAllGroupElements(std::vector&lt; proshade_unsign &gt; axesList, std::string groupType=&quot;&quot;, proshade_double matrixTolerance=0.05)</div><div class="ttdoc">This function returns the group elements as rotation matrices of any defined point group.</div><div class="ttdef"><b>Definition:</b> <a href="_pro_s_h_a_d_e__data_8cpp_source.html#l03122">ProSHADE_data.cpp:3122</a></div></div>
<div class="ttc" id="anamespace_pro_s_h_a_d_e__internal__misc_html_a68c3eafaeea1c1873c33525f337f9d0b"><div class="ttname"><a href="namespace_pro_s_h_a_d_e__internal__misc.html#a68c3eafaeea1c1873c33525f337f9d0b">ProSHADE_internal_misc::addToDoubleVector</a></div><div class="ttdeci">void addToDoubleVector(std::vector&lt; proshade_double &gt; *vecToAddTo, proshade_double elementToAdd)</div><div class="ttdoc">Adds the element to the vector.</div><div class="ttdef"><b>Definition:</b> <a href="_pro_s_h_a_d_e__misc_8cpp_source.html#l00077">ProSHADE_misc.cpp:77</a></div></div>
<div class="ttc" id="aclass_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data_html_a3bc44913222e67ab861dd1e5838c1ae1"><div class="ttname"><a href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html#a3bc44913222e67ab861dd1e5838c1ae1">ProSHADE_internal_data::ProSHADE_data::getXDim</a></div><div class="ttdeci">proshade_unsign getXDim(void)</div><div class="ttdoc">This function allows access to the map size in indices along the X axis.</div><div class="ttdef"><b>Definition:</b> <a href="_pro_s_h_a_d_e__data_8cpp_source.html#l04074">ProSHADE_data.cpp:4074</a></div></div>
<div class="ttc" id="aclass_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data_html_a3704cb64f672f4edc5a7f1de2642fc44"><div class="ttname"><a href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html#a3704cb64f672f4edc5a7f1de2642fc44">ProSHADE_internal_data::ProSHADE_data::getCyclicAxes</a></div><div class="ttdeci">std::vector&lt; proshade_double * &gt; * getCyclicAxes(void)</div><div class="ttdoc">This function allows access to the list of detected cyclic axes.</div><div class="ttdef"><b>Definition:</b> <a href="_pro_s_h_a_d_e__data_8cpp_source.html#l04239">ProSHADE_data.cpp:4239</a></div></div>
<div class="ttc" id="aclass_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data_html_a50c884973add562558803a45991bbf19"><div class="ttname"><a href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html#a50c884973add562558803a45991bbf19">ProSHADE_internal_data::ProSHADE_data::getYDim</a></div><div class="ttdeci">proshade_unsign getYDim(void)</div><div class="ttdoc">This function allows access to the map size in indices along the Y axis.</div><div class="ttdef"><b>Definition:</b> <a href="_pro_s_h_a_d_e__data_8cpp_source.html#l04084">ProSHADE_data.cpp:4084</a></div></div>
<div class="ttc" id="aclass_pro_s_h_a_d_e__settings_html"><div class="ttname"><a href="class_pro_s_h_a_d_e__settings.html">ProSHADE_settings</a></div><div class="ttdoc">This class stores all the settings and is passed to the executive classes instead of a multitude of p...</div><div class="ttdef"><b>Definition:</b> <a href="_pro_s_h_a_d_e__settings_8hpp_source.html#l00036">ProSHADE_settings.hpp:37</a></div></div>
<div class="ttc" id="aclass_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data_html_a034af93b9152fb2db675d5632a4ebc6d"><div class="ttname"><a href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html#a034af93b9152fb2db675d5632a4ebc6d">ProSHADE_internal_data::ProSHADE_data::getZDim</a></div><div class="ttdeci">proshade_unsign getZDim(void)</div><div class="ttdoc">This function allows access to the map size in indices along the Z axis.</div><div class="ttdef"><b>Definition:</b> <a href="_pro_s_h_a_d_e__data_8cpp_source.html#l04094">ProSHADE_data.cpp:4094</a></div></div>
<div class="ttc" id="aclass_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data_html_afe04510c67e9dc9c19efaef8463b6e6e"><div class="ttname"><a href="class_pro_s_h_a_d_e__internal__data_1_1_pro_s_h_a_d_e__data.html#afe04510c67e9dc9c19efaef8463b6e6e">ProSHADE_internal_data::ProSHADE_data::getMapValue</a></div><div class="ttdeci">proshade_double getMapValue(proshade_unsign pos)</div><div class="ttdoc">This function returns the internal map representation value of a particular array position.</div><div class="ttdef"><b>Definition:</b> <a href="_pro_s_h_a_d_e__data_8cpp_source.html#l03738">ProSHADE_data.cpp:3738</a></div></div>
<div class="ttc" id="anamespace_pro_s_h_a_d_e__internal__symmetry_html_a4e67dc983f98cde3963b0d805f41ce30"><div class="ttname"><a href="namespace_pro_s_h_a_d_e__internal__symmetry.html#a4e67dc983f98cde3963b0d805f41ce30">ProSHADE_internal_symmetry::releaseCentreOfMapFourierTransforms</a></div><div class="ttdeci">void releaseCentreOfMapFourierTransforms(fftw_complex *origMap, fftw_complex *origCoeffs, fftw_complex *rotMapComplex, fftw_complex *rotCoeffs, fftw_complex *trFunc, fftw_complex *trFuncCoeffs, fftw_plan planForwardFourier, fftw_plan planForwardFourierRot, fftw_plan planReverseFourierComb)</div><div class="ttdoc">This function releases the allocated memory for the Fourier transforms used to find the centre of the...</div><div class="ttdef"><b>Definition:</b> <a href="_pro_s_h_a_d_e__symmetry_8cpp_source.html#l03881">ProSHADE_symmetry.cpp:3881</a></div></div>
<div class="ttc" id="anamespace_pro_s_h_a_d_e__internal__misc_html_af556836aa9286c1571196de442a6b493"><div class="ttname"><a href="namespace_pro_s_h_a_d_e__internal__misc.html#af556836aa9286c1571196de442a6b493">ProSHADE_internal_misc::checkMemoryAllocation</a></div><div class="ttdeci">void checkMemoryAllocation(chVar checkVar, std::string fileP, unsigned int lineP, std::string funcP, std::string infoP=&quot;This error may occurs when ProSHADE requests memory to be\n                    : allocated to it and this operation fails. This could\n                    : happen when not enough memory is available, either due to\n                    : other processes using a lot of memory, or when the machine\n                    : does not have sufficient memory available. Re-run to see\n                    : if this problem persists.&quot;)</div><div class="ttdoc">Checks if memory was allocated properly.</div><div class="ttdef"><b>Definition:</b> <a href="_pro_s_h_a_d_e__misc_8hpp_source.html#l00073">ProSHADE_misc.hpp:73</a></div></div>
<div class="ttc" id="anamespace_pro_s_h_a_d_e__internal__misc_html_ad9fbf28fda3873fc511fa2000ccba86c"><div class="ttname"><a href="namespace_pro_s_h_a_d_e__internal__misc.html#ad9fbf28fda3873fc511fa2000ccba86c">ProSHADE_internal_misc::addToDoubleVectorVector</a></div><div class="ttdeci">void addToDoubleVectorVector(std::vector&lt; std::vector&lt; proshade_double &gt; &gt; *vecToAddTo, std::vector&lt; proshade_double &gt; elementToAdd)</div><div class="ttdoc">Adds the element to the vector of vectors.</div><div class="ttdef"><b>Definition:</b> <a href="_pro_s_h_a_d_e__misc_8cpp_source.html#l00233">ProSHADE_misc.cpp:233</a></div></div>
<div class="ttc" id="anamespace_pro_s_h_a_d_e__internal__misc_html_a16336bdf0b391c953a549d3df115d691"><div class="ttname"><a href="namespace_pro_s_h_a_d_e__internal__misc.html#a16336bdf0b391c953a549d3df115d691">ProSHADE_internal_misc::addToUnsignVector</a></div><div class="ttdeci">void addToUnsignVector(std::vector&lt; proshade_unsign &gt; *vecToAddTo, proshade_unsign elementToAdd)</div><div class="ttdoc">Adds the element to the vector.</div><div class="ttdef"><b>Definition:</b> <a href="_pro_s_h_a_d_e__misc_8cpp_source.html#l00099">ProSHADE_misc.cpp:99</a></div></div>
<div class="ttc" id="aclass_pro_s_h_a_d_e__settings_html_a4627b03c4064d3de15efb3ebbf57ed78"><div class="ttname"><a href="class_pro_s_h_a_d_e__settings.html#a4627b03c4064d3de15efb3ebbf57ed78">ProSHADE_settings::axisErrTolerance</a></div><div class="ttdeci">proshade_double axisErrTolerance</div><div class="ttdoc">Allowed error on vector axis in in dot product ( acos ( 1 - axErr ) is the allowed difference in radi...</div><div class="ttdef"><b>Definition:</b> <a href="_pro_s_h_a_d_e__settings_8hpp_source.html#l00132">ProSHADE_settings.hpp:132</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_5c0d64f70903e893b1efe571a4b8de29.html">python</a></li><li class="navelem"><a class="el" href="py_pro_s_h_a_d_e__symmetry_8cpp.html">pyProSHADE_symmetry.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
