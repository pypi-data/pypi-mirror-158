(function(t){function e(e){for(var n,i,o=e[0],l=e[1],c=e[2],f=0,d=[];f<o.length;f++)i=o[f],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&d.push(a[i][0]),a[i]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);u&&u(e);while(d.length)d.shift()();return s.push.apply(s,c||[]),r()}function r(){for(var t,e=0;e<s.length;e++){for(var r=s[e],n=!0,o=1;o<r.length;o++){var l=r[o];0!==a[l]&&(n=!1)}n&&(s.splice(e--,1),t=i(i.s=r[0]))}return t}var n={},a={app:0},s=[];function i(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=n,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var u=l;s.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("56d7")},1:function(t,e){},"56d7":function(t,e,r){"use strict";r.r(e);r("cadf"),r("551c"),r("f751"),r("097d"),r("75ab");var n=r("2b0e"),a=r("9062"),s=r.n(a),i=(r("bd0f"),r("28dd")),o=r("5f5b"),l=(r("f9e3"),r("2dd8"),function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"app"}},[r("table-view")],1)}),c=[],u=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t.csvUrl?t._e():r("b-form",{staticClass:"m-4"},[r("b-input",{staticClass:"mb-2 mt-2",attrs:{placeholder:"URL du fichier à visualiser (CSV ou XLS)"},model:{value:t.csvUrlFieldValue,callback:function(e){t.csvUrlFieldValue=e},expression:"csvUrlFieldValue"}}),r("b-button",{attrs:{variant:"primary"},on:{click:t.redirect}},[t._v("Lancer la conversion 🚀")])],1),t.hasError?r("Error",{attrs:{error:t.error}}):t._e(),t.csvUrl&&!t.hasError?r("Table"):t._e()],1)},f=[],d=(r("28a5"),r("768b")),p=r("75fc"),h=(r("ac6a"),r("386d"),function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t.filtersEnabled?r("Filters"):t._e(),r("div",{staticClass:"table-responsive"},[r("b-table",{staticClass:"m-2",attrs:{hover:"",small:"",items:t.rows,fields:t.fields,"no-local-sorting":!0},on:{"sort-changed":t.sort}})],1),t.totalRows?r("b-pagination",{attrs:{align:"center","total-rows":t.totalRows,"per-page":t.pageSize},on:{input:t.changePage},model:{value:t.page,callback:function(e){t.page=e},expression:"page"}}):t._e()],1)}),m=[];function v(t,e){var r=document.querySelector(t);return r?r.getAttribute(e):void 0}function b(t){return v("meta[name=".concat(t,"]"),"content")}var g=Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_CSVAPI_URL||b("csvapi-url"),_=b("page-size")||10,y=Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_FILTERS_ENABLED||b("filters-enabled");try{y=JSON.parse(y)}catch(K){y=!1}var w=y,E=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"m-2 ml-3"},[r("b-button",{attrs:{variant:"primary"},on:{click:function(e){e.preventDefault(),t.filtersVisible=!t.filtersVisible}}},[t._v(" 🔎 "+t._s(t.filtersVisible?"Masquer":"Afficher")+" les filtres "),t.filters.length?r("span",[t._v("("+t._s(t.filters.length)+")")]):t._e()]),r("b-button",{staticClass:"ml-sm-2 mt-2 mt-sm-0",attrs:{variant:"primary",target:"_blank",rel:"noopener noreferrer",href:t.$store.state.profileEndpoint}},[t._v("🕵️ Explorer les données")]),r("b-collapse",{staticClass:"mt-2",model:{value:t.filtersVisible,callback:function(e){t.filtersVisible=e},expression:"filtersVisible"}},[r("b-card",{attrs:{"no-body":""}},[t.filters.length?r("b-list-group",{attrs:{flush:""}},t._l(t.filters,(function(e,n){return r("b-list-group-item",{key:n},[t._v(" "+t._s('"'+e.field+'" '+t.getCompLabel(e.comp)+' "'+e.value+'"')+" "),r("a",{staticClass:"float-right",attrs:{href:""},on:{click:function(e){return e.preventDefault(),t.deleteFilter(n)}}},[t._v("Supprimer le filtre")])])})),1):t._e(),r("b-form",{staticClass:"m-2",attrs:{inline:""},on:{submit:function(t){t.preventDefault()}}},[r("b-form-select",{staticClass:"mr-1",attrs:{"value-field":"key","text-field":"label",options:t.fields},model:{value:t.filter.field,callback:function(e){t.$set(t.filter,"field",e)},expression:"filter.field"}}),r("b-form-select",{staticClass:"mr-1",attrs:{options:t.comparators},model:{value:t.filter.comp,callback:function(e){t.$set(t.filter,"comp",e)},expression:"filter.comp"}}),r("b-input",{staticClass:"mr-1",model:{value:t.filter.value,callback:function(e){t.$set(t.filter,"value",e)},expression:"filter.value"}}),r("b-button",{attrs:{variant:"primary"},on:{click:t.addFilter}},[t._v("Filtrer")])],1)],1)],1)],1)},S=[],P=(r("7514"),r("6b54"),{name:"Filters",data:function(){return{comparators:[{value:"exact",text:"est égal à"},{value:"contains",text:"contient"}],filtersVisible:!1,filter:{field:"",value:"",comp:""}}},computed:{filters:function(){return this.$store.state.filters},fields:function(){return this.$store.getters.fields}},methods:{getSearchParams:function(){return new URLSearchParams(document.location.search)},setSearchParams:function(t){window.history.pushState(null,"","/?".concat(t.toString()))},addToQueryString:function(t,e){var r=this.getSearchParams();r.set(t,e),this.setSearchParams(r)},removeFromQueryString:function(t){var e=this.getSearchParams();e.delete(t),this.setSearchParams(e)},getCompLabel:function(t){if(t)return this.comparators.find((function(e){return e.value==t})).text},addFilter:function(){this.$store.commit("addFilter",this.filter),this.addToQueryString("".concat(this.filter.field,"__").concat(this.filter.comp),this.filter.value),this.filter={field:"",value:"",comp:""},this.$store.dispatch("getData")},deleteFilter:function(t){var e=this.filters[t];this.removeFromQueryString("".concat(e.field,"__").concat(e.comp)),this.$store.commit("deleteFilter",t),this.$store.dispatch("getData")}}}),$=P,x=r("2877"),O=Object(x["a"])($,E,S,!1,null,null,null),U=O.exports,k={name:"Table",components:{Filters:U},data:function(){return{filtersEnabled:w}},computed:{rows:function(){return this.$store.state.rows},totalRows:function(){return this.$store.state.totalRows},fields:function(){return this.$store.getters.fields},pageSize:function(){return this.$store.state.pageSize},page:{get:function(){return this.$store.state.page},set:function(t){this.$store.commit("setPage",t)}}},methods:{sort:function(t){return this.$store.dispatch("sort",t)},changePage:function(){return this.$store.dispatch("changePage")}}},F=k,R=Object(x["a"])(F,h,m,!1,null,null,null),j=R.exports,V=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"m-4"},[r("b-card",{attrs:{"header-bg-variant":"danger","border-variant":"danger",header:"🤕 Nous n'avons pas pu convertir ce fichier","header-border-variant":"danger","header-text-variant":"white",align:"center"}},[r("b-card-text",[r("dl",[r("dt",[t._v("Détails de l'erreur")]),r("dd",[t._v(" "+t._s(t.error.error)+" "),t.error.details?r("span",[t._v(" "+t._s(t.error.details))]):t._e()]),t.error.id?r("dt",[t._v("Identifiant de l'erreur")]):t._e(),t.error.id?r("dd",[t._v(t._s(t.error.id))]):t._e()]),r("b-button",{attrs:{variant:"outline-danger",size:"lg"},on:{click:t.openIssue}},[t._v("Signaler cette erreur sur Github")])],1)],1)],1)},C=[],D={name:"Error",props:["error"],methods:{openIssue:function(){var t="Impossible de convertir le fichier",e="\nImpossible de convertir le fichier situé ici : ".concat(this.csvUrl,"%0A%0A\n").concat(this.error.error," ").concat(this.error.details||"","%0A%0A\nIdentifiant : ").concat(this.error.id||"","\n"),r="https://github.com/etalab/csvapi/issues/new?labels=live-feedback&title=".concat(t,"&body=").concat(e);window.open(r,"_blank")}}},L=D,T=Object(x["a"])(L,V,C,!1,null,null,null),A=T.exports,I={name:"TableView",components:{Table:j,Error:A},data:function(){return{csvUrl:"",csvUrlFieldValue:""}},computed:{error:function(){return this.$store.state.error},hasError:function(){return this.$store.state.hasError}},created:function(){var t=new URLSearchParams(document.location.search);this.setFiltersFromQueryString(t);var e=t.get("url");e&&(this.csvUrl=e)},methods:{setFiltersFromQueryString:function(t){var e=this;Object(p["a"])(t.entries()).filter((function(t){var e=Object(d["a"])(t,2),r=e[0];e[1];return-1!==r.indexOf("__")&&0!==r.indexOf("_")})).forEach((function(t){var r=Object(d["a"])(t,2),n=r[0],a=r[1];e.$store.commit("addFilter",{field:n.split("__")[0],value:a,comp:n.split("__")[1]})}))},changePage:function(t){this.$store.dispatch("changePage")},sort:function(t){this.$store.dispatch("sort",t)},apify:function(t){this.$store.dispatch("apify",t)},redirect:function(){this.csvUrl=this.csvUrlFieldValue,history.pushState(null,"","/?url=".concat(this.csvUrl))}},watch:{csvUrl:function(t){if(t){var e=this.$loading.show();this.$store.dispatch("apify",this.csvUrl).finally((function(){e.hide()}))}}}},B=I,z=Object(x["a"])(B,u,f,!1,null,"0eea51d5",null),N=z.exports,Q={name:"app",components:{TableView:N}},M=Q,J=Object(x["a"])(M,l,c,!1,null,null,null),q=J.exports,G=(r("96cf"),r("3b8d")),X=r("2f62");n["default"].use(X["a"]);var H=new X["a"].Store({state:{rows:[],columns:[],fields:[],filters:[],page:1,pageSize:_,dataEndpoint:void 0,profileEndpoint:void 0,sortBy:void 0,sortDesc:void 0,totalRows:0,error:void 0,hasError:!1},getters:{fields:function(t){return t.columns.map((function(t){return{key:t,label:t,sortable:!0}}))}},actions:{handleError:function(t,e){var r=t.commit;console.error(e),r("setError",{error:e.body.error,details:e.body.details,id:e.body.error_id})},changePage:function(t){var e=t.dispatch;return e("getData")},sort:function(t,e){var r=t.commit,n=t.dispatch;return r("setSort",{by:e.sortBy,desc:e.sortDesc}),n("getData")},makeDataUrl:function(t){var e=t.state,r=_*(e.page-1),n=new URL(e.dataEndpoint);if(n.searchParams.set("_shape","objects"),n.searchParams.set("_rowid","hide"),n.searchParams.set("_size",_),n.searchParams.set("_offset",r),e.filters.forEach((function(t){var e=t.field,r=t.value,a=t.comp;n.searchParams.set("".concat(e,"__").concat(a),r)})),e.sortBy){var a=e.sortDesc?"_sort_desc":"_sort";n.searchParams.set(a,e.sortBy)}return n},getData:function(){var t=Object(G["a"])(regeneratorRuntime.mark((function t(e){var r,n,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.state,n=e.commit,a=e.dispatch,t.next=3,a("makeDataUrl");case 3:s=t.sent,this.$http.get(s.toString()).then((function(t){t.body.ok?(n("setRows",t.body.rows),r.columns.length||n("setColumns",t.body.columns),n("setTotalRows",t.body.total)):a("handleError",t)})).catch((function(t){return a("handleError",t)}));case 5:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),apify:function(t,e){var r=t.commit,n=t.dispatch,a=new URL(g);return a.pathname="/apify",a.searchParams.set("url",encodeURI(e)),this.$http.get(a.toString()).then((function(t){return t.body.ok&&t.body.endpoint?(r("setEndpoints",t.body),n("getData")):n("showError",t)})).catch((function(t){return n("handleError",t)}))}},mutations:{setEndpoints:function(t,e){t.dataEndpoint=e.endpoint,t.profileEndpoint=e.profile_endpoint},setRows:function(t,e){t.rows=e},setPage:function(t,e){t.page=e},setColumns:function(t,e){t.columns=e},setTotalRows:function(t,e){t.totalRows=e},setError:function(t,e){t.error=e,t.hasError=!0},setSort:function(t,e){t.sortBy=e.by,t.sortDesc=e.desc},addFilter:function(t,e){t.filters.push(e)},deleteFilter:function(t,e){t.filters.splice(e,1)}}});n["default"].use(s.a),n["default"].use(i["a"]),n["default"].use(o["a"]),n["default"].config.productionTip=!1,H.$http=n["default"].http,new n["default"]({store:H,render:function(t){return t(q)}}).$mount("#app")}});
//# sourceMappingURL=app.js.map