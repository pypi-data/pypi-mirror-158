"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[173],{311:function(e,t,n){n.d(t,{Z:function(){return Z}});var o=n(6042),i=n(9396),r=n(5893),s=n(7294),a=n(1163),c=n(9008),u=n.n(c),l=n(8298),d=n(2734),p=n(2293),f=n(3156),m=n(155),v=n(6886),h=n(3321),y=n(5861),x=n(7357);function g(e){var t=e.children,n=(0,l.Z)({disableHysteresis:!0,threshold:24});return(0,s.cloneElement)(t,{elevation:n?4:0})}var b=function(){var e=(0,s.useState)(!1),t=e[0],n=e[1],o=((0,s.useCallback)((function(){n(!t)}),[t]),(0,d.Z)());return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(g,{children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.Z,{color:"transparent",elevation:0,children:(0,r.jsx)(f.Z,{maxWidth:"xl",sx:{padding:0},children:(0,r.jsx)(m.Z,{sx:{minHeight:50,maxHeight:50,padding:0,flex:1,alignItems:"center",justifyContent:"space-between",display:"flex",flexWrap:"nowrap"},children:(0,r.jsx)(v.ZP,{item:!0,children:(0,r.jsx)(h.Z,{href:"https://system-bridge.timmo.dev",target:"_blank",children:(0,r.jsx)(y.Z,{component:"div",variant:"h4",sx:{textTransform:"none",userSelect:"none",color:o.palette.primary.contrastText},children:"System Bridge"})})})})})}),(0,r.jsx)(x.Z,{sx:{height:o.spacing(18)}})]})})})},k=!1;var Z=function(e){var t=(0,a.useRouter)();return(0,s.useEffect)((function(){if(t.isReady&&!k){var e,n,r,s;k=!0;var a=(null===(e=t.query)||void 0===e?void 0:e.apiKey)||"",c=(null===(n=t.query)||void 0===n?void 0:n.apiPort)||"9170",u=!1;if((null===(r=t.query)||void 0===r?void 0:r.apiKey)||(u=!0,a=window.prompt("Please enter your API key",a)),(null===(s=t.query)||void 0===s?void 0:s.apiPort)||(u=!0,c=window.prompt("Please enter your API port (default: 9170)",c)),u&&a&&c){var l=t.asPath.split("?")[0];t.replace({pathname:l.includes(".html")?l:"".concat(l,".html"),query:(0,i.Z)((0,o.Z)({},t.query),{apiKey:a,apiPort:c})})}}}),[t]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(u(),{children:[(0,r.jsx)("title",{children:e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,r.jsx)("link",{rel:"canonical",href:e.url}),(0,r.jsx)("meta",{name:"description",content:e.description?"".concat(e.description):e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,r.jsx)("meta",{name:"keywords",content:e.keywords?"".concat(e.keywords):"system-bridge, system, bridge, typescript"})]}),!e.noHeader&&(0,r.jsx)(b,{}),e.children]})}},8768:function(e,t,n){n.d(t,{D:function(){return r},X:function(){return i}});var o=n(7294);function i(e){navigator.permissions.query({name:"clipboard-write"}).then((function(t){"granted"!==t.state&&"prompt"!==t.state||navigator.clipboard.writeText(e)}))}function r(e){var t=(0,o.useRef)();return(0,o.useEffect)((function(){t.current=e})),t.current}},8838:function(e,t,n){n.d(t,{C:function(){return a}});var o=n(7568),i=n(1438),r=n(4051),s=n.n(r),a=function(){function e(t,n,r){(0,i.Z)(this,e),this.port=t||9170,this.apiKey=n;var a=this;(0,o.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.connect();case 2:a.websocket=e.sent,r&&a.websocket&&a.websocket.readyState===a.websocket.OPEN&&r();case 4:case"end":return e.stop()}}),e)})))()}var t=e.prototype;return t.close=function(){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.close()},t.connect=function(){var e=this;return(0,o.Z)(s().mark((function t(){var n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new WebSocket("ws://".concat(window.location.hostname||"localhost",":").concat(e.port,"/api/websocket")),t.next=3,new Promise((function(e){n.onopen=function(){return e()}}));case 3:return n.onmessage=function(t){if("string"===typeof t.data){var n=JSON.parse(t.data);n&&e.onEvent&&e.onEvent(n)}},t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})))()},t.isConnected=function(){var e;return(null===(e=this.websocket)||void 0===e?void 0:e.readyState)===WebSocket.OPEN},t.getData=function(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Get data:",e),this.websocket.send(JSON.stringify({"api-key":this.apiKey,event:"GET_DATA",modules:e})))},t.getSettings=function(){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Get settings"),this.websocket.send(JSON.stringify({"api-key":this.apiKey,event:"GET_SETTINGS"})))},t.registerDataListener=function(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Register data listener:",e),this.websocket.send(JSON.stringify({"api-key":this.apiKey,event:"REGISTER_DATA_LISTENER",modules:e})))},t.sendPlayerStatus=function(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.send(JSON.stringify({"api-key":this.apiKey,event:"MEDIA_STATUS",status:e}))},t.updateSetting=function(e,t){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Update setting:",{key:e,value:t}),this.websocket.send(JSON.stringify({"api-key":this.apiKey,event:"UPDATE_SETTING",setting:e,value:t})))},e}()},7902:function(e,t,n){n.d(t,{Z:function(){return _}});var o=n(7568),i=n(6042),r=n(9396),s=n(603),a=n(4051),c=n.n(a),u=n(5893),l=n(7294),d=n(387),p=n(6486),f=n(3564),m=n(8768),v=n(8838),h=n(2734),y=n(6886),x=n(7357),g=n(2022),b=n(6628),k=n(5861),Z=n(3946),w=n(5273),S=n(8849),j=n(3648),P=n(381),E=n.n(P),C=n(6310);var I=function(){var e=function(){B(!1),p(!0)},t=function(){O&&ee(O)},n=(0,s.Z)((0,f.nn)(),2),o=n[0],a=n[1],c=(0,l.useState)(!1),d=c[0],p=c[1],m=(0,s.Z)((0,f.XI)(),2),v=m[0],P=m[1],I=(0,l.useRef)(null),D=(0,l.useMemo)((function(){return o}),[o]),N=D.duration,_=D.playing,M=D.muted,T=D.loaded,O=D.position,A=D.volume,U=(0,l.useMemo)((function(){return"".concat((100*A).toFixed(0),"%")}),[A]),L=(0,l.useMemo)((function(){var e=E().duration(O,"seconds");return"".concat(e.minutes().toString().padStart(2,"0"),":").concat(e.seconds().toString().padStart(2,"0"))}),[O]),K=(0,l.useMemo)((function(){var e=E().duration(N,"seconds");return"".concat(e.minutes().toString().padStart(2,"0"),":").concat(e.seconds().toString().padStart(2,"0"))}),[N]),R=(0,l.useMemo)((function(){return o.source}),[o]),W=R.artist,q=R.album,F=R.cover,G=R.source,J=R.title,z=(0,l.useCallback)((function(e){a((0,r.Z)((0,i.Z)({},o),{loaded:e}))}),[o,a]),B=(0,l.useCallback)((function(e){a((0,r.Z)((0,i.Z)({},o),{playing:e}))}),[o,a]),H=(0,l.useCallback)((function(){B(!_)}),[_,B]),V=(0,l.useCallback)((function(e){a((0,r.Z)((0,i.Z)({},o),{muted:e}))}),[o,a]),X=(0,l.useCallback)((function(){V(!M)}),[M,V]),Y=(0,l.useCallback)((function(e,t){var n="down"===t?A-e:"up"===t?A+e:e;n>1&&(n=1),n<0&&(n=0),a((0,r.Z)((0,i.Z)({},o),{volume:n})),M&&V(!1)}),[M,A,o,a,V]),Q=(0,l.useCallback)((function(e){a((0,r.Z)((0,i.Z)({},o),{duration:e}))}),[o,a]),$=(0,l.useCallback)((function(e){N&&e>N&&(e=N),e<0&&(e=0),a((0,r.Z)((0,i.Z)({},o),{position:e}))}),[o,N,a]),ee=(0,l.useCallback)((function(e){var t;null===(t=I.current)||void 0===t||t.seekTo(e,"seconds"),p(!1),_||B(!0)}),[_,B]);(0,l.useEffect)((function(){T||z(!0)}),[T,z,B]);var te=(0,h.Z)();return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(C.Z,{ref:I,height:"0px",width:"0px",muted:M,playing:_,stopOnUnmount:!0,url:G,volume:A,onDuration:function(e){Q(e)},onPause:function(){B(!1)},onPlay:function(){B(!0)},onStart:function(){B(!0)},onProgress:function(e){var t=e.playedSeconds;d||$(t)}}),(0,u.jsxs)(y.ZP,{container:!0,direction:"row",alignItems:"center",justifyItems:"center",wrap:"nowrap",sx:{height:140,width:540,overflow:"hidden"},children:[(0,u.jsx)(y.ZP,{item:!0,sx:{width:140,margin:te.spacing(0,1,0,0)},children:(0,u.jsx)(x.Z,{ref:v,children:(0,u.jsxs)(g.Z,{"aria-label":_?"Pause":"Play",onClick:H,children:[(0,u.jsx)("img",{alt:"".concat(W," - ").concat(q),src:F||"https://raw.githubusercontent.com/timmo001/system-bridge/master/resources/system-bridge-dimmed.svg",width:140}),(0,u.jsx)(b.Z,{in:!!P,timeout:{enter:200,exit:400},children:(0,u.jsx)(x.Z,{sx:{position:"absolute",display:"flex",height:"100%",width:"100%",zIndex:100},children:(0,u.jsx)(S.Icon,{id:_?"pause":"play",path:_?j.Wa1:j._86,size:6,style:{position:"relative",margin:"auto"}})})})]})})}),(0,u.jsx)(y.ZP,{item:!0,xs:!0,children:(0,u.jsxs)(y.ZP,{container:!0,direction:"column",alignItems:"flex-start",justifyItems:"space-around",children:[(0,u.jsx)(y.ZP,{item:!0,children:(0,u.jsxs)(k.Z,{color:"textPrimary",component:"span",variant:"subtitle1",noWrap:!0,children:[W," - ",J]})}),(0,u.jsx)(y.ZP,{item:!0,children:(0,u.jsx)(k.Z,{color:"textSecondary",component:"span",variant:"subtitle2",noWrap:!0,children:q})}),(0,u.jsxs)(y.ZP,{item:!0,container:!0,alignContent:"center",children:[(0,u.jsx)(y.ZP,{item:!0,xs:4}),(0,u.jsx)(y.ZP,{sx:{margin:te.spacing(0,1,0,0)},item:!0,children:(0,u.jsx)(Z.Z,{size:"small",onClick:X,children:M?(0,u.jsx)(S.Icon,{id:"mute",path:j.PLS,size:1.25}):(0,u.jsx)(S.Icon,{id:"unmute",path:j.dw,size:1.25})})}),(0,u.jsx)(y.ZP,{sx:{margin:te.spacing(.6,2,0,0)},item:!0,xs:!0,children:(0,u.jsx)(w.ZP,{min:0,max:1,step:.01,value:A,onChange:function(e,t){"number"===typeof t&&Y(t)}})}),(0,u.jsx)(y.ZP,{sx:{margin:te.spacing(.9,A>=1?1:2,0,0)},item:!0,children:(0,u.jsx)(k.Z,{component:"span",variant:"body2",children:U})})]}),(0,u.jsxs)(y.ZP,{container:!0,children:[(0,u.jsx)(y.ZP,{sx:{margin:te.spacing(.25,2,0,0)},item:!0,children:(0,u.jsx)(k.Z,{component:"span",variant:"body2",children:L})}),(0,u.jsx)(y.ZP,{sx:{margin:te.spacing(0,2,0,0)},item:!0,xs:!0,children:(0,u.jsx)(w.ZP,{min:0,max:N,step:.1,value:O,valueLabelDisplay:"off",onMouseDown:e,onKeyDown:e,onChange:function(e,t){$(t)},onMouseUp:t,onKeyUp:t})}),(0,u.jsx)(y.ZP,{sx:{margin:te.spacing(.25,1,0,0)},item:!0,children:(0,u.jsx)(k.Z,{component:"span",variant:"body2",children:K})})]})]})})]})]})};var D,N=function(){var e=(0,s.Z)((0,f.nn)(),2),t=e[0],n=e[1],o=(0,l.useRef)(null),a=(0,l.useMemo)((function(){return t}),[t]),c=a.duration,d=a.playing,p=a.muted,m=a.loaded,v=a.volume,h=(0,l.useMemo)((function(){return t.source}),[t]).source,y=(0,l.useCallback)((function(e){n((0,r.Z)((0,i.Z)({},t),{loaded:e}))}),[t,n]),x=(0,l.useCallback)((function(e){return n((0,r.Z)((0,i.Z)({},t),{playing:e}))}),[t,n]),g=(0,l.useCallback)((function(e){return n((0,r.Z)((0,i.Z)({},t),{duration:e}))}),[t,n]),b=(0,l.useCallback)((function(e){c&&e>c&&(e=c),e<0&&(e=0),n((0,r.Z)((0,i.Z)({},t),{position:e}))}),[t,c,n]);return(0,l.useEffect)((function(){m||y(!0)}),[m,y,x]),(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(C.Z,{controls:!0,pip:!0,ref:o,playing:d,height:"100%",width:"100%",style:{margin:0,overflow:"hidden"},url:h,muted:p,volume:v,onDuration:function(e){return g(e)},onPause:function(){return x(!1)},onPlay:function(){return x(!0)},onStart:function(){return x(!0)},onProgress:function(e){var t=e.playedSeconds;return b(t)}})})};var _=function(e){var t=e.playerType,n=(0,l.useState)(!1),a=n[0],h=n[1],y=(0,s.Z)((0,f.nn)(),2),x=y[0],g=y[1],b=(0,m.D)(x),k=(0,d.useRouter)(),Z=k.query,w=(0,l.useCallback)((function(e){switch(console.log("Event:",e),e.type){case"MEDIA_PAUSE":g((0,r.Z)((0,i.Z)({},x),{playing:!1}));break;case"MEDIA_PLAY":g((0,r.Z)((0,i.Z)({},x),{playing:!0}));break;case"MEDIA_VOLUME_DOWN":e.volume&&g((0,r.Z)((0,i.Z)({},x),{volume:x.volume-e.volume}));break;case"MEDIA_VOLUME_UP":e.volume&&g((0,r.Z)((0,i.Z)({},x),{volume:x.volume+e.volume}));break;case"MEDIA_VOLUME_SET":e.volume&&g((0,r.Z)((0,i.Z)({},x),{volume:e.volume}));break;case"MEDIA_VOLUME_SET":e.position&&g((0,r.Z)((0,i.Z)({},x),{position:e.position}))}}),[x,g]),S=(0,l.useCallback)((function(e,t){console.log("Setup WebSocketConnection"),(D=new v.C(e,t,(0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Connected to WebSocket");case 1:case"end":return e.stop()}}),e)}))))).onEvent=w}),[w]);(0,l.useEffect)((function(){!a&&Z&&Z.apiKey&&(h(!0),S(Number(Z.apiPort)||9170,String(Z.apiKey)))}),[a,S,Z]),(0,l.useEffect)((function(){if(!x&&k.isReady){var e=Number(Z.volume);switch(t){default:break;case"audio":var n;g({muted:!1,playing:"true"===(null===(n=Z.autoplay)||void 0===n?void 0:n.toLowerCase()),loaded:!1,position:0,duration:1,source:{type:"audio",source:Z.url,album:Z.album||"Unknown Album",artist:Z.artist||"Unknown Aritst",cover:Z.cover,title:Z.title||"Unknown Title",volumeInitial:(e>0?e:40)/100},volume:(e>0?e:40)/100});break;case"video":g({muted:!1,playing:!1,loaded:!1,position:0,duration:1,source:{type:"video",source:String(Z.url),volumeInitial:(e>0?e:40)/100},volume:(e>0?e:40)/100})}}}),[x,g,t,k,Z]),(0,l.useEffect)((function(){if(x){var e;b&&"audio"===(e=(0,p.cloneDeep)(b)).source.type&&delete e.source.cover;var t=(0,p.cloneDeep)(x);if("audio"===t.source.type&&delete t.source.cover,!(0,p.isEqual)(t,e)){if(console.log("Player update\n\npreviousStatus:",e,"\nnewStatus:",t),!t.loaded)return;if(!D)return;if(!D.isConnected())return h(!1),void console.warn("WebSocket not connected");D.sendPlayerStatus(t)}}}),[x,b]);var j=(0,l.useMemo)((function(){if(x)return x.source.type}),[x]);return(0,u.jsx)(u.Fragment,{children:"audio"===j?(0,u.jsx)(I,{}):"video"===j?(0,u.jsx)(N,{}):""})}},3564:function(e,t,n){n.d(t,{I0:function(){return c},XI:function(){return l},nn:function(){return u}});var o=n(603),i=n(5893),r=n(7294),s=(0,r.createContext)(void 0),a=(0,r.createContext)(null),c=function(e){var t=e.children,n=(0,r.useState)(),o=n[0],c=n[1];return(0,i.jsx)(a.Provider,{value:c,children:(0,i.jsx)(s.Provider,{value:o,children:t})})},u=function(){var e=(0,r.useContext)(s),t=(0,r.useContext)(a);if(null===t)throw new Error;return[e,t]};function l(){var e=(0,o.Z)(r.useState(!1),2),t=e[0],n=e[1],i=r.useCallback((function(){return n(!0)}),[]),s=r.useCallback((function(){return n(!1)}),[]),a=r.useRef();return[r.useCallback((function(e){a.current&&(a.current.removeEventListener("mouseover",i),a.current.removeEventListener("mouseout",s)),a.current=e,a.current&&(a.current.addEventListener("mouseover",i),a.current.addEventListener("mouseout",s))}),[i,s]),t]}}}]);