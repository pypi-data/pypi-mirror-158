import{S as St,i as At,s as It,e as at,c as ut,a as st,d as H,b as Q,g as jt,L as Dt,R as Wt,E as _t,a0 as qt,W as ot,D as Ft,Z as Jt,_ as Kt,w as Et,x as Pt,y as Ct,q as Yt,o as Xt,B as Vt,v as Qt}from"../chunks/index-c0d1c2b0.js";import{d as Ut}from"../chunks/stores-ad474281.js";import{i as Zt,S as ct,r as Bt,a as Ht,d as dt,t as te,T as lt,b as yt,c as ht,l as ee,L as ne}from"../chunks/DataFlowGraph.svelte_svelte_type_style_lang-4d986b94.js";import"../chunks/index-40ab4bbb.js";class wt extends Map{constructor(e,n=oe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[r,a]of e)this.set(r,a)}get(e){return super.get(bt(this,e))}has(e){return super.has(bt(this,e))}set(e,n){return super.set(re(this,e),n)}delete(e){return super.delete(ie(this,e))}}function bt({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function re({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}function ie({_intern:t,_key:e},n){const r=e(n);return t.has(r)&&(n=t.get(r),t.delete(r)),n}function oe(t){return t!==null&&typeof t=="object"?t.valueOf():t}const Mt=Symbol("implicit");function Ot(){var t=new wt,e=[],n=[],r=Mt;function a(i){let o=t.get(i);if(o===void 0){if(r!==Mt)return r;t.set(i,o=e.push(i)-1)}return n[o%n.length]}return a.domain=function(i){if(!arguments.length)return e.slice();e=[],t=new wt;for(const o of i)t.has(o)||t.set(o,e.push(o)-1);return a},a.range=function(i){return arguments.length?(n=Array.from(i),a):n.slice()},a.unknown=function(i){return arguments.length?(r=i,a):r},a.copy=function(){return Ot(e,n).unknown(r)},Zt.apply(a,arguments),a}var ae=1e-12;function zt(t){return((t=Math.exp(t))+1/t)/2}function ue(t){return((t=Math.exp(t))-1/t)/2}function se(t){return((t=Math.exp(2*t))-1)/(t+1)}var ce=function t(e,n,r){function a(i,o){var h=i[0],x=i[1],l=i[2],y=o[0],M=o[1],v=o[2],m=y-h,w=M-x,c=m*m+w*w,g,f;if(c<ae)f=Math.log(v/l)/e,g=function(S){return[h+S*m,x+S*w,l*Math.exp(e*S*f)]};else{var _=Math.sqrt(c),T=(v*v-l*l+r*c)/(2*l*n*_),s=(v*v-l*l-r*c)/(2*v*n*_),k=Math.log(Math.sqrt(T*T+1)-T),$=Math.log(Math.sqrt(s*s+1)-s);f=($-k)/e,g=function(S){var j=S*f,E=zt(k),d=l/(n*_)*(E*se(e*j+k)-ue(k));return[h+d*m,x+d*w,l*E/zt(e*j+k)]}}return g.duration=f*1e3*e/Math.SQRT2,g}return a.rho=function(i){var o=Math.max(.001,+i),h=o*o,x=h*h;return t(o,h,x)},a}(Math.SQRT2,2,4);function F(t){return typeof t=="string"?new ct([[document.querySelector(t)]],[document.documentElement]):new ct([[t]],Bt)}function fe(t){let e;for(;e=t.sourceEvent;)t=e;return t}function q(t,e){if(t=fe(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var a=e.getBoundingClientRect();return[t.clientX-a.left-e.clientLeft,t.clientY-a.top-e.clientTop]}}return[t.pageX,t.pageY]}function le(t){return typeof t=="string"?new ct([document.querySelectorAll(t)],[document.documentElement]):new ct([Ht(t)],Bt)}const he={passive:!1},nt={capture:!0,passive:!1};function gt(t){t.stopImmediatePropagation()}function tt(t){t.preventDefault(),t.stopImmediatePropagation()}function Rt(t){var e=t.document.documentElement,n=F(t).on("dragstart.drag",tt,nt);"onselectstart"in e?n.on("selectstart.drag",tt,nt):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Lt(t,e){var n=t.document.documentElement,r=F(t).on("dragstart.drag",null);e&&(r.on("click.drag",tt,nt),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}var rt=t=>()=>t;function pt(t,{sourceEvent:e,subject:n,target:r,identifier:a,active:i,x:o,y:h,dx:x,dy:l,dispatch:y}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:a,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:h,enumerable:!0,configurable:!0},dx:{value:x,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:y}})}pt.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function ge(t){return!t.ctrlKey&&!t.button}function me(){return this.parentNode}function pe(t,e){return e==null?{x:t.x,y:t.y}:e}function de(){return navigator.maxTouchPoints||"ontouchstart"in this}function ye(){var t=ge,e=me,n=pe,r=de,a={},i=dt("start","drag","end"),o=0,h,x,l,y,M=0;function v(s){s.on("mousedown.drag",m).filter(r).on("touchstart.drag",g).on("touchmove.drag",f,he).on("touchend.drag touchcancel.drag",_).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(s,k){if(!(y||!t.call(this,s,k))){var $=T(this,e.call(this,s,k),s,k,"mouse");!$||(F(s.view).on("mousemove.drag",w,nt).on("mouseup.drag",c,nt),Rt(s.view),gt(s),l=!1,h=s.clientX,x=s.clientY,$("start",s))}}function w(s){if(tt(s),!l){var k=s.clientX-h,$=s.clientY-x;l=k*k+$*$>M}a.mouse("drag",s)}function c(s){F(s.view).on("mousemove.drag mouseup.drag",null),Lt(s.view,l),tt(s),a.mouse("end",s)}function g(s,k){if(!!t.call(this,s,k)){var $=s.changedTouches,S=e.call(this,s,k),j=$.length,E,d;for(E=0;E<j;++E)(d=T(this,S,s,k,$[E].identifier,$[E]))&&(gt(s),d("start",s,$[E]))}}function f(s){var k=s.changedTouches,$=k.length,S,j;for(S=0;S<$;++S)(j=a[k[S].identifier])&&(tt(s),j("drag",s,k[S]))}function _(s){var k=s.changedTouches,$=k.length,S,j;for(y&&clearTimeout(y),y=setTimeout(function(){y=null},500),S=0;S<$;++S)(j=a[k[S].identifier])&&(gt(s),j("end",s,k[S]))}function T(s,k,$,S,j,E){var d=i.copy(),D=q(E||$,k),X,P,u;if((u=n.call(s,new pt("beforestart",{sourceEvent:$,target:v,identifier:j,active:o,x:D[0],y:D[1],dx:0,dy:0,dispatch:d}),S))!=null)return X=u.x-D[0]||0,P=u.y-D[1]||0,function b(p,z,N){var A=D,I;switch(p){case"start":a[j]=b,I=o++;break;case"end":delete a[j],--o;case"drag":D=q(N||z,k),I=o;break}d.call(p,s,new pt(p,{sourceEvent:z,subject:u,target:v,identifier:j,active:I,x:D[0]+X,y:D[1]+P,dx:D[0]-A[0],dy:D[1]-A[1],dispatch:d}),S)}}return v.filter=function(s){return arguments.length?(t=typeof s=="function"?s:rt(!!s),v):t},v.container=function(s){return arguments.length?(e=typeof s=="function"?s:rt(s),v):e},v.subject=function(s){return arguments.length?(n=typeof s=="function"?s:rt(s),v):n},v.touchable=function(s){return arguments.length?(r=typeof s=="function"?s:rt(!!s),v):r},v.on=function(){var s=i.on.apply(i,arguments);return s===i?v:s},v.clickDistance=function(s){return arguments.length?(M=(s=+s)*s,v):Math.sqrt(M)},v}function ve(t,e){var n,r=1;t==null&&(t=0),e==null&&(e=0);function a(){var i,o=n.length,h,x=0,l=0;for(i=0;i<o;++i)h=n[i],x+=h.x,l+=h.y;for(x=(x/o-t)*r,l=(l/o-e)*r,i=0;i<o;++i)h=n[i],h.x-=x,h.y-=l}return a.initialize=function(i){n=i},a.x=function(i){return arguments.length?(t=+i,a):t},a.y=function(i){return arguments.length?(e=+i,a):e},a.strength=function(i){return arguments.length?(r=+i,a):r},a}function xe(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return Gt(this.cover(e,n),e,n,t)}function Gt(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var a,i=t._root,o={data:r},h=t._x0,x=t._y0,l=t._x1,y=t._y1,M,v,m,w,c,g,f,_;if(!i)return t._root=o,t;for(;i.length;)if((c=e>=(M=(h+l)/2))?h=M:l=M,(g=n>=(v=(x+y)/2))?x=v:y=v,a=i,!(i=i[f=g<<1|c]))return a[f]=o,t;if(m=+t._x.call(null,i.data),w=+t._y.call(null,i.data),e===m&&n===w)return o.next=i,a?a[f]=o:t._root=o,t;do a=a?a[f]=new Array(4):t._root=new Array(4),(c=e>=(M=(h+l)/2))?h=M:l=M,(g=n>=(v=(x+y)/2))?x=v:y=v;while((f=g<<1|c)===(_=(w>=v)<<1|m>=M));return a[_]=i,a[f]=o,t}function _e(t){var e,n,r=t.length,a,i,o=new Array(r),h=new Array(r),x=1/0,l=1/0,y=-1/0,M=-1/0;for(n=0;n<r;++n)isNaN(a=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||(o[n]=a,h[n]=i,a<x&&(x=a),a>y&&(y=a),i<l&&(l=i),i>M&&(M=i));if(x>y||l>M)return this;for(this.cover(x,l).cover(y,M),n=0;n<r;++n)Gt(this,o[n],h[n],t[n]);return this}function we(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,a=this._x1,i=this._y1;if(isNaN(n))a=(n=Math.floor(t))+1,i=(r=Math.floor(e))+1;else{for(var o=a-n||1,h=this._root,x,l;n>t||t>=a||r>e||e>=i;)switch(l=(e<r)<<1|t<n,x=new Array(4),x[l]=h,h=x,o*=2,l){case 0:a=n+o,i=r+o;break;case 1:n=a-o,i=r+o;break;case 2:a=n+o,r=i-o;break;case 3:n=a-o,r=i-o;break}this._root&&this._root.length&&(this._root=h)}return this._x0=n,this._y0=r,this._x1=a,this._y1=i,this}function be(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function Me(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function B(t,e,n,r,a){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=a}function ze(t,e,n){var r,a=this._x0,i=this._y0,o,h,x,l,y=this._x1,M=this._y1,v=[],m=this._root,w,c;for(m&&v.push(new B(m,a,i,y,M)),n==null?n=1/0:(a=t-n,i=e-n,y=t+n,M=e+n,n*=n);w=v.pop();)if(!(!(m=w.node)||(o=w.x0)>y||(h=w.y0)>M||(x=w.x1)<a||(l=w.y1)<i))if(m.length){var g=(o+x)/2,f=(h+l)/2;v.push(new B(m[3],g,f,x,l),new B(m[2],o,f,g,l),new B(m[1],g,h,x,f),new B(m[0],o,h,g,f)),(c=(e>=f)<<1|t>=g)&&(w=v[v.length-1],v[v.length-1]=v[v.length-1-c],v[v.length-1-c]=w)}else{var _=t-+this._x.call(null,m.data),T=e-+this._y.call(null,m.data),s=_*_+T*T;if(s<n){var k=Math.sqrt(n=s);a=t-k,i=e-k,y=t+k,M=e+k,r=m.data}}return r}function ke(t){if(isNaN(y=+this._x.call(null,t))||isNaN(M=+this._y.call(null,t)))return this;var e,n=this._root,r,a,i,o=this._x0,h=this._y0,x=this._x1,l=this._y1,y,M,v,m,w,c,g,f;if(!n)return this;if(n.length)for(;;){if((w=y>=(v=(o+x)/2))?o=v:x=v,(c=M>=(m=(h+l)/2))?h=m:l=m,e=n,!(n=n[g=c<<1|w]))return this;if(!n.length)break;(e[g+1&3]||e[g+2&3]||e[g+3&3])&&(r=e,f=g)}for(;n.data!==t;)if(a=n,!(n=n.next))return this;return(i=n.next)&&delete n.next,a?(i?a.next=i:delete a.next,this):e?(i?e[g]=i:delete e[g],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(r?r[f]=n:this._root=n),this):(this._root=i,this)}function Te(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function $e(){return this._root}function Ne(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function Se(t){var e=[],n,r=this._root,a,i,o,h,x;for(r&&e.push(new B(r,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(r=n.node,i=n.x0,o=n.y0,h=n.x1,x=n.y1)&&r.length){var l=(i+h)/2,y=(o+x)/2;(a=r[3])&&e.push(new B(a,l,y,h,x)),(a=r[2])&&e.push(new B(a,i,y,l,x)),(a=r[1])&&e.push(new B(a,l,o,h,y)),(a=r[0])&&e.push(new B(a,i,o,l,y))}return this}function Ae(t){var e=[],n=[],r;for(this._root&&e.push(new B(this._root,this._x0,this._y0,this._x1,this._y1));r=e.pop();){var a=r.node;if(a.length){var i,o=r.x0,h=r.y0,x=r.x1,l=r.y1,y=(o+x)/2,M=(h+l)/2;(i=a[0])&&e.push(new B(i,o,h,y,M)),(i=a[1])&&e.push(new B(i,y,h,x,M)),(i=a[2])&&e.push(new B(i,o,M,y,l)),(i=a[3])&&e.push(new B(i,y,M,x,l))}n.push(r)}for(;r=n.pop();)t(r.node,r.x0,r.y0,r.x1,r.y1);return this}function Ie(t){return t[0]}function je(t){return arguments.length?(this._x=t,this):this._x}function De(t){return t[1]}function Ee(t){return arguments.length?(this._y=t,this):this._y}function vt(t,e,n){var r=new xt(e==null?Ie:e,n==null?De:n,NaN,NaN,NaN,NaN);return t==null?r:r.addAll(t)}function xt(t,e,n,r,a,i){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=a,this._y1=i,this._root=void 0}function kt(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var O=vt.prototype=xt.prototype;O.copy=function(){var t=new xt(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,r;if(!e)return t;if(!e.length)return t._root=kt(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var a=0;a<4;++a)(r=e.source[a])&&(r.length?n.push({source:r,target:e.target[a]=new Array(4)}):e.target[a]=kt(r));return t};O.add=xe;O.addAll=_e;O.cover=we;O.data=be;O.extent=Me;O.find=ze;O.remove=ke;O.removeAll=Te;O.root=$e;O.size=Ne;O.visit=Se;O.visitAfter=Ae;O.x=je;O.y=Ee;function Z(t){return function(){return t}}function U(t){return(t()-.5)*1e-6}function Pe(t){return t.x+t.vx}function Ce(t){return t.y+t.vy}function Ye(t){var e,n,r,a=1,i=1;typeof t!="function"&&(t=Z(t==null?1:+t));function o(){for(var l,y=e.length,M,v,m,w,c,g,f=0;f<i;++f)for(M=vt(e,Pe,Ce).visitAfter(h),l=0;l<y;++l)v=e[l],c=n[v.index],g=c*c,m=v.x+v.vx,w=v.y+v.vy,M.visit(_);function _(T,s,k,$,S){var j=T.data,E=T.r,d=c+E;if(j){if(j.index>v.index){var D=m-j.x-j.vx,X=w-j.y-j.vy,P=D*D+X*X;P<d*d&&(D===0&&(D=U(r),P+=D*D),X===0&&(X=U(r),P+=X*X),P=(d-(P=Math.sqrt(P)))/P*a,v.vx+=(D*=P)*(d=(E*=E)/(g+E)),v.vy+=(X*=P)*d,j.vx-=D*(d=1-d),j.vy-=X*d)}return}return s>m+d||$<m-d||k>w+d||S<w-d}}function h(l){if(l.data)return l.r=n[l.data.index];for(var y=l.r=0;y<4;++y)l[y]&&l[y].r>l.r&&(l.r=l[y].r)}function x(){if(!!e){var l,y=e.length,M;for(n=new Array(y),l=0;l<y;++l)M=e[l],n[M.index]=+t(M,l,e)}}return o.initialize=function(l,y){e=l,r=y,x()},o.iterations=function(l){return arguments.length?(i=+l,o):i},o.strength=function(l){return arguments.length?(a=+l,o):a},o.radius=function(l){return arguments.length?(t=typeof l=="function"?l:Z(+l),x(),o):t},o}function Xe(t){return t.index}function Tt(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function Ve(t){var e=Xe,n=M,r,a=Z(30),i,o,h,x,l,y=1;t==null&&(t=[]);function M(g){return 1/Math.min(h[g.source.index],h[g.target.index])}function v(g){for(var f=0,_=t.length;f<y;++f)for(var T=0,s,k,$,S,j,E,d;T<_;++T)s=t[T],k=s.source,$=s.target,S=$.x+$.vx-k.x-k.vx||U(l),j=$.y+$.vy-k.y-k.vy||U(l),E=Math.sqrt(S*S+j*j),E=(E-i[T])/E*g*r[T],S*=E,j*=E,$.vx-=S*(d=x[T]),$.vy-=j*d,k.vx+=S*(d=1-d),k.vy+=j*d}function m(){if(!!o){var g,f=o.length,_=t.length,T=new Map(o.map((k,$)=>[e(k,$,o),k])),s;for(g=0,h=new Array(f);g<_;++g)s=t[g],s.index=g,typeof s.source!="object"&&(s.source=Tt(T,s.source)),typeof s.target!="object"&&(s.target=Tt(T,s.target)),h[s.source.index]=(h[s.source.index]||0)+1,h[s.target.index]=(h[s.target.index]||0)+1;for(g=0,x=new Array(_);g<_;++g)s=t[g],x[g]=h[s.source.index]/(h[s.source.index]+h[s.target.index]);r=new Array(_),w(),i=new Array(_),c()}}function w(){if(!!o)for(var g=0,f=t.length;g<f;++g)r[g]=+n(t[g],g,t)}function c(){if(!!o)for(var g=0,f=t.length;g<f;++g)i[g]=+a(t[g],g,t)}return v.initialize=function(g,f){o=g,l=f,m()},v.links=function(g){return arguments.length?(t=g,m(),v):t},v.id=function(g){return arguments.length?(e=g,v):e},v.iterations=function(g){return arguments.length?(y=+g,v):y},v.strength=function(g){return arguments.length?(n=typeof g=="function"?g:Z(+g),w(),v):n},v.distance=function(g){return arguments.length?(a=typeof g=="function"?g:Z(+g),c(),v):a},v}const Be=1664525,Oe=1013904223,$t=4294967296;function Re(){let t=1;return()=>(t=(Be*t+Oe)%$t)/$t}function Le(t){return t.x}function Ge(t){return t.y}var We=10,qe=Math.PI*(3-Math.sqrt(5));function Fe(t){var e,n=1,r=.001,a=1-Math.pow(r,1/300),i=0,o=.6,h=new Map,x=te(M),l=dt("tick","end"),y=Re();t==null&&(t=[]);function M(){v(),l.call("tick",e),n<r&&(x.stop(),l.call("end",e))}function v(c){var g,f=t.length,_;c===void 0&&(c=1);for(var T=0;T<c;++T)for(n+=(i-n)*a,h.forEach(function(s){s(n)}),g=0;g<f;++g)_=t[g],_.fx==null?_.x+=_.vx*=o:(_.x=_.fx,_.vx=0),_.fy==null?_.y+=_.vy*=o:(_.y=_.fy,_.vy=0);return e}function m(){for(var c=0,g=t.length,f;c<g;++c){if(f=t[c],f.index=c,f.fx!=null&&(f.x=f.fx),f.fy!=null&&(f.y=f.fy),isNaN(f.x)||isNaN(f.y)){var _=We*Math.sqrt(.5+c),T=c*qe;f.x=_*Math.cos(T),f.y=_*Math.sin(T)}(isNaN(f.vx)||isNaN(f.vy))&&(f.vx=f.vy=0)}}function w(c){return c.initialize&&c.initialize(t,y),c}return m(),e={tick:v,restart:function(){return x.restart(M),e},stop:function(){return x.stop(),e},nodes:function(c){return arguments.length?(t=c,m(),h.forEach(w),e):t},alpha:function(c){return arguments.length?(n=+c,e):n},alphaMin:function(c){return arguments.length?(r=+c,e):r},alphaDecay:function(c){return arguments.length?(a=+c,e):+a},alphaTarget:function(c){return arguments.length?(i=+c,e):i},velocityDecay:function(c){return arguments.length?(o=1-c,e):1-o},randomSource:function(c){return arguments.length?(y=c,h.forEach(w),e):y},force:function(c,g){return arguments.length>1?(g==null?h.delete(c):h.set(c,w(g)),e):h.get(c)},find:function(c,g,f){var _=0,T=t.length,s,k,$,S,j;for(f==null?f=1/0:f*=f,_=0;_<T;++_)S=t[_],s=c-S.x,k=g-S.y,$=s*s+k*k,$<f&&(j=S,f=$);return j},on:function(c,g){return arguments.length>1?(l.on(c,g),e):l.on(c)}}}function Je(){var t,e,n,r,a=Z(-30),i,o=1,h=1/0,x=.81;function l(m){var w,c=t.length,g=vt(t,Le,Ge).visitAfter(M);for(r=m,w=0;w<c;++w)e=t[w],g.visit(v)}function y(){if(!!t){var m,w=t.length,c;for(i=new Array(w),m=0;m<w;++m)c=t[m],i[c.index]=+a(c,m,t)}}function M(m){var w=0,c,g,f=0,_,T,s;if(m.length){for(_=T=s=0;s<4;++s)(c=m[s])&&(g=Math.abs(c.value))&&(w+=c.value,f+=g,_+=g*c.x,T+=g*c.y);m.x=_/f,m.y=T/f}else{c=m,c.x=c.data.x,c.y=c.data.y;do w+=i[c.data.index];while(c=c.next)}m.value=w}function v(m,w,c,g){if(!m.value)return!0;var f=m.x-e.x,_=m.y-e.y,T=g-w,s=f*f+_*_;if(T*T/x<s)return s<h&&(f===0&&(f=U(n),s+=f*f),_===0&&(_=U(n),s+=_*_),s<o&&(s=Math.sqrt(o*s)),e.vx+=f*m.value*r/s,e.vy+=_*m.value*r/s),!0;if(m.length||s>=h)return;(m.data!==e||m.next)&&(f===0&&(f=U(n),s+=f*f),_===0&&(_=U(n),s+=_*_),s<o&&(s=Math.sqrt(o*s)));do m.data!==e&&(T=i[m.data.index]*r/s,e.vx+=f*T,e.vy+=_*T);while(m=m.next)}return l.initialize=function(m,w){t=m,n=w,y()},l.strength=function(m){return arguments.length?(a=typeof m=="function"?m:Z(+m),y(),l):a},l.distanceMin=function(m){return arguments.length?(o=m*m,l):Math.sqrt(o)},l.distanceMax=function(m){return arguments.length?(h=m*m,l):Math.sqrt(h)},l.theta=function(m){return arguments.length?(x=m*m,l):Math.sqrt(x)},l}function Ke(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(r*6,++r*6);return n}var Qe=Ke("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),it=t=>()=>t;function Ue(t,{sourceEvent:e,target:n,transform:r,dispatch:a}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:a}})}function mt(t){t.stopImmediatePropagation()}function et(t){t.preventDefault(),t.stopImmediatePropagation()}function Ze(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function He(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function Nt(){return this.__zoom||yt}function tn(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function en(){return navigator.maxTouchPoints||"ontouchstart"in this}function nn(t,e,n){var r=t.invertX(e[0][0])-n[0][0],a=t.invertX(e[1][0])-n[1][0],i=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(a>r?(r+a)/2:Math.min(0,r)||Math.max(0,a),o>i?(i+o)/2:Math.min(0,i)||Math.max(0,o))}function rn(){var t=Ze,e=He,n=nn,r=tn,a=en,i=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],h=250,x=ce,l=dt("start","zoom","end"),y,M,v,m=500,w=150,c=0,g=10;function f(u){u.property("__zoom",Nt).on("wheel.zoom",j,{passive:!1}).on("mousedown.zoom",E).on("dblclick.zoom",d).filter(a).on("touchstart.zoom",D).on("touchmove.zoom",X).on("touchend.zoom touchcancel.zoom",P).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}f.transform=function(u,b,p,z){var N=u.selection?u.selection():u;N.property("__zoom",Nt),u!==N?k(u,b,p,z):N.interrupt().each(function(){$(this,arguments).event(z).start().zoom(null,typeof b=="function"?b.apply(this,arguments):b).end()})},f.scaleBy=function(u,b,p,z){f.scaleTo(u,function(){var N=this.__zoom.k,A=typeof b=="function"?b.apply(this,arguments):b;return N*A},p,z)},f.scaleTo=function(u,b,p,z){f.transform(u,function(){var N=e.apply(this,arguments),A=this.__zoom,I=p==null?s(N):typeof p=="function"?p.apply(this,arguments):p,C=A.invert(I),Y=typeof b=="function"?b.apply(this,arguments):b;return n(T(_(A,Y),I,C),N,o)},p,z)},f.translateBy=function(u,b,p,z){f.transform(u,function(){return n(this.__zoom.translate(typeof b=="function"?b.apply(this,arguments):b,typeof p=="function"?p.apply(this,arguments):p),e.apply(this,arguments),o)},null,z)},f.translateTo=function(u,b,p,z,N){f.transform(u,function(){var A=e.apply(this,arguments),I=this.__zoom,C=z==null?s(A):typeof z=="function"?z.apply(this,arguments):z;return n(yt.translate(C[0],C[1]).scale(I.k).translate(typeof b=="function"?-b.apply(this,arguments):-b,typeof p=="function"?-p.apply(this,arguments):-p),A,o)},z,N)};function _(u,b){return b=Math.max(i[0],Math.min(i[1],b)),b===u.k?u:new lt(b,u.x,u.y)}function T(u,b,p){var z=b[0]-p[0]*u.k,N=b[1]-p[1]*u.k;return z===u.x&&N===u.y?u:new lt(u.k,z,N)}function s(u){return[(+u[0][0]+ +u[1][0])/2,(+u[0][1]+ +u[1][1])/2]}function k(u,b,p,z){u.on("start.zoom",function(){$(this,arguments).event(z).start()}).on("interrupt.zoom end.zoom",function(){$(this,arguments).event(z).end()}).tween("zoom",function(){var N=this,A=arguments,I=$(N,A).event(z),C=e.apply(N,A),Y=p==null?s(C):typeof p=="function"?p.apply(N,A):p,W=Math.max(C[1][0]-C[0][0],C[1][1]-C[0][1]),V=N.__zoom,L=typeof b=="function"?b.apply(N,A):b,J=x(V.invert(Y).concat(W/V.k),L.invert(Y).concat(W/L.k));return function(G){if(G===1)G=L;else{var K=J(G),ft=W/K[2];G=new lt(ft,Y[0]-K[0]*ft,Y[1]-K[1]*ft)}I.zoom(null,G)}})}function $(u,b,p){return!p&&u.__zooming||new S(u,b)}function S(u,b){this.that=u,this.args=b,this.active=0,this.sourceEvent=null,this.extent=e.apply(u,b),this.taps=0}S.prototype={event:function(u){return u&&(this.sourceEvent=u),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(u,b){return this.mouse&&u!=="mouse"&&(this.mouse[1]=b.invert(this.mouse[0])),this.touch0&&u!=="touch"&&(this.touch0[1]=b.invert(this.touch0[0])),this.touch1&&u!=="touch"&&(this.touch1[1]=b.invert(this.touch1[0])),this.that.__zoom=b,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(u){var b=F(this.that).datum();l.call(u,this.that,new Ue(u,{sourceEvent:this.sourceEvent,target:f,type:u,transform:this.that.__zoom,dispatch:l}),b)}};function j(u,...b){if(!t.apply(this,arguments))return;var p=$(this,b).event(u),z=this.__zoom,N=Math.max(i[0],Math.min(i[1],z.k*Math.pow(2,r.apply(this,arguments)))),A=q(u);if(p.wheel)(p.mouse[0][0]!==A[0]||p.mouse[0][1]!==A[1])&&(p.mouse[1]=z.invert(p.mouse[0]=A)),clearTimeout(p.wheel);else{if(z.k===N)return;p.mouse=[A,z.invert(A)],ht(this),p.start()}et(u),p.wheel=setTimeout(I,w),p.zoom("mouse",n(T(_(z,N),p.mouse[0],p.mouse[1]),p.extent,o));function I(){p.wheel=null,p.end()}}function E(u,...b){if(v||!t.apply(this,arguments))return;var p=u.currentTarget,z=$(this,b,!0).event(u),N=F(u.view).on("mousemove.zoom",Y,!0).on("mouseup.zoom",W,!0),A=q(u,p),I=u.clientX,C=u.clientY;Rt(u.view),mt(u),z.mouse=[A,this.__zoom.invert(A)],ht(this),z.start();function Y(V){if(et(V),!z.moved){var L=V.clientX-I,J=V.clientY-C;z.moved=L*L+J*J>c}z.event(V).zoom("mouse",n(T(z.that.__zoom,z.mouse[0]=q(V,p),z.mouse[1]),z.extent,o))}function W(V){N.on("mousemove.zoom mouseup.zoom",null),Lt(V.view,z.moved),et(V),z.event(V).end()}}function d(u,...b){if(!!t.apply(this,arguments)){var p=this.__zoom,z=q(u.changedTouches?u.changedTouches[0]:u,this),N=p.invert(z),A=p.k*(u.shiftKey?.5:2),I=n(T(_(p,A),z,N),e.apply(this,b),o);et(u),h>0?F(this).transition().duration(h).call(k,I,z,u):F(this).call(f.transform,I,z,u)}}function D(u,...b){if(!!t.apply(this,arguments)){var p=u.touches,z=p.length,N=$(this,b,u.changedTouches.length===z).event(u),A,I,C,Y;for(mt(u),I=0;I<z;++I)C=p[I],Y=q(C,this),Y=[Y,this.__zoom.invert(Y),C.identifier],N.touch0?!N.touch1&&N.touch0[2]!==Y[2]&&(N.touch1=Y,N.taps=0):(N.touch0=Y,A=!0,N.taps=1+!!y);y&&(y=clearTimeout(y)),A&&(N.taps<2&&(M=Y[0],y=setTimeout(function(){y=null},m)),ht(this),N.start())}}function X(u,...b){if(!!this.__zooming){var p=$(this,b).event(u),z=u.changedTouches,N=z.length,A,I,C,Y;for(et(u),A=0;A<N;++A)I=z[A],C=q(I,this),p.touch0&&p.touch0[2]===I.identifier?p.touch0[0]=C:p.touch1&&p.touch1[2]===I.identifier&&(p.touch1[0]=C);if(I=p.that.__zoom,p.touch1){var W=p.touch0[0],V=p.touch0[1],L=p.touch1[0],J=p.touch1[1],G=(G=L[0]-W[0])*G+(G=L[1]-W[1])*G,K=(K=J[0]-V[0])*K+(K=J[1]-V[1])*K;I=_(I,Math.sqrt(G/K)),C=[(W[0]+L[0])/2,(W[1]+L[1])/2],Y=[(V[0]+J[0])/2,(V[1]+J[1])/2]}else if(p.touch0)C=p.touch0[0],Y=p.touch0[1];else return;p.zoom("touch",n(T(I,C,Y),p.extent,o))}}function P(u,...b){if(!!this.__zooming){var p=$(this,b).event(u),z=u.changedTouches,N=z.length,A,I;for(mt(u),v&&clearTimeout(v),v=setTimeout(function(){v=null},m),A=0;A<N;++A)I=z[A],p.touch0&&p.touch0[2]===I.identifier?delete p.touch0:p.touch1&&p.touch1[2]===I.identifier&&delete p.touch1;if(p.touch1&&!p.touch0&&(p.touch0=p.touch1,delete p.touch1),p.touch0)p.touch0[1]=this.__zoom.invert(p.touch0[0]);else if(p.end(),p.taps===2&&(I=q(I,this),Math.hypot(M[0]-I[0],M[1]-I[1])<g)){var C=F(this).on("dblclick.zoom");C&&C.apply(this,arguments)}}}return f.wheelDelta=function(u){return arguments.length?(r=typeof u=="function"?u:it(+u),f):r},f.filter=function(u){return arguments.length?(t=typeof u=="function"?u:it(!!u),f):t},f.touchable=function(u){return arguments.length?(a=typeof u=="function"?u:it(!!u),f):a},f.extent=function(u){return arguments.length?(e=typeof u=="function"?u:it([[+u[0][0],+u[0][1]],[+u[1][0],+u[1][1]]]),f):e},f.scaleExtent=function(u){return arguments.length?(i[0]=+u[0],i[1]=+u[1],f):[i[0],i[1]]},f.translateExtent=function(u){return arguments.length?(o[0][0]=+u[0][0],o[1][0]=+u[1][0],o[0][1]=+u[0][1],o[1][1]=+u[1][1],f):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},f.constrain=function(u){return arguments.length?(n=u,f):n},f.duration=function(u){return arguments.length?(h=+u,f):h},f.interpolate=function(u){return arguments.length?(x=u,f):x},f.on=function(){var u=l.on.apply(l,arguments);return u===l?f:u},f.clickDistance=function(u){return arguments.length?(c=(u=+u)*u,f):Math.sqrt(c)},f.tapDistance=function(u){return arguments.length?(g=+u,f):g},f}function on(t){let e,n,r,a;return{c(){e=at("div"),n=at("canvas"),this.h()},l(i){e=ut(i,"DIV",{class:!0});var o=st(e);n=ut(o,"CANVAS",{width:!0,height:!0,class:!0}),st(n).forEach(H),o.forEach(H),this.h()},h(){Q(n,"width",t[2]),Q(n,"height",t[1]),Q(n,"class","svelte-zs93ed"),Q(e,"class","container")},m(i,o){jt(i,e,o),Dt(e,n),t[8](n),r||(a=Wt(window,"resize",t[6]),r=!0)},p(i,[o]){o&4&&Q(n,"width",i[2]),o&2&&Q(n,"height",i[1])},i:_t,o:_t,d(i){i&&H(e),t[8](null),r=!1,a()}}}const R=5;function an(t,e,n){let r,a,i,o;const{data:h,width:x,height:l}=qt("LayerCake");ot(t,h,d=>n(7,o=d)),ot(t,x,d=>n(2,i=d)),ot(t,l,d=>n(1,a=d));let y={zoom:rn,zoomIdentity:yt,scaleLinear:ee,scaleOrdinal:Ot,schemeCategory10:Qe,select:F,selectAll:le,pointer:q,drag:ye,forceSimulation:Fe,forceLink:Ve,forceManyBody:Je,forceCenter:ve,forceCollide:Ye},M;const v=y.scaleOrdinal(y.schemeCategory10);let m=y.zoomIdentity,w,c;const g=h.subscribe(async d=>{await Ft(),f()});Jt(()=>{g()});function f(){console.log({graph:r}),w&&(w.nodes([]).force("link",y.forceLink([])),w=void 0),c=M.getContext("2d"),w=y.forceSimulation(r.nodes).force("link",y.forceLink(r.links).id(d=>d.name)).force("charge",y.forceManyBody()).force("center",y.forceCenter(i/2,a/2)).on("tick",_),y.select(c.canvas).on("mousemove",d=>{const D=y.pointer(d),X=w.find(m.invertX(D[0]),m.invertY(D[1]),R);X?c.canvas.title=X.index:c.canvas.title=""}),y.select(M).call(y.drag().container(M).subject(s).on("start",k).on("drag",$).on("end",S)).call(y.zoom().scaleExtent([1/10,8]).on("zoom",T))}function _(){c.save(),c.clearRect(0,0,c.canvas.width,c.canvas.height),c.translate(m.x,m.y),c.scale(m.k,m.k),r.links.forEach(d=>{if(!(d.source.name=="__broker__"||d.target.name=="__broker__")){c.beginPath();var D=d.target.x-d.source.x,X=d.target.y-d.source.y,P=Math.atan2(X,D),u=R;c.moveTo(d.source.x,d.source.y),c.lineTo(d.target.x-Math.cos(P)*R*1.2,d.target.y-Math.sin(P)*R*1.2),c.lineTo(d.target.x-Math.cos(P)*R*1.2-u*Math.cos(P-Math.PI/6),d.target.y-Math.sin(P)*R*1.2-u*Math.sin(P-Math.PI/6)),c.moveTo(d.target.x-Math.cos(P)*R*1.2,d.target.y-Math.sin(P)*R*1.2),c.lineTo(d.target.x-Math.cos(P)*R*1.2-u*Math.cos(P+Math.PI/6),d.target.y-Math.sin(P)*R*1.2-u*Math.sin(P+Math.PI/6)),c.globalAlpha=.6,c.strokeStyle="#999",c.lineWidth=Math.sqrt(d.value),c.stroke(),c.globalAlpha=1}}),r.nodes.forEach((d,D)=>{d.name!="__broker__"&&(c.beginPath(),c.arc(d.x,d.y,R,0,2*Math.PI),c.strokeStyle="#fff",c.lineWidth=1.5,c.stroke(),c.fillStyle=v(d.group),c.fill(),c.fillText(d.name,d.x+10,d.y+3))}),c.restore()}function T(d){m=d.transform,_()}function s(d){const D=w.find(m.invertX(d.x),m.invertY(d.y),R);return D&&(D.x=m.applyX(D.x),D.y=m.applyY(D.y)),D}function k(d){d.active||w.alphaTarget(.3).restart(),d.subject.fx=m.invertX(d.subject.x),d.subject.fy=m.invertY(d.subject.y)}function $(d){d.subject.fx=m.invertX(d.x),d.subject.fy=m.invertY(d.y)}function S(d){d.active||w.alphaTarget(0),d.subject.fx=null,d.subject.fy=null}function j(){}function E(d){Kt[d?"unshift":"push"](()=>{M=d,n(0,M)})}return t.$$.update=()=>{t.$$.dirty&128&&(r=o.length==0?{nodes:[],links:[]}:o)},[M,a,i,h,x,l,j,o,E]}class un extends St{constructor(e){super(),At(this,e,an,on,It,{})}}function sn(t){let e,n;return e=new un({}),{c(){Et(e.$$.fragment)},l(r){Pt(e.$$.fragment,r)},m(r,a){Ct(e,r,a),n=!0},i(r){n||(Yt(e.$$.fragment,r),n=!0)},o(r){Xt(e.$$.fragment,r),n=!1},d(r){Vt(e,r)}}}function cn(t){let e,n,r,a;return r=new ne({props:{data:t[0],$$slots:{default:[sn]},$$scope:{ctx:t}}}),{c(){e=at("div"),n=at("div"),Et(r.$$.fragment),this.h()},l(i){e=ut(i,"DIV",{class:!0});var o=st(e);n=ut(o,"DIV",{class:!0});var h=st(n);Pt(r.$$.fragment,h),h.forEach(H),o.forEach(H),this.h()},h(){Q(n,"class","grow grid grid-areas-layout justify-items-stretch my-auto"),Q(e,"class","flex flex-col h-full")},m(i,o){jt(i,e,o),Dt(e,n),Ct(r,n,null),a=!0},p(i,[o]){const h={};o&1&&(h.data=i[0]),o&4&&(h.$$scope={dirty:o,ctx:i}),r.$set(h)},i(i){a||(Yt(r.$$.fragment,i),a=!0)},o(i){Xt(r.$$.fragment,i),a=!1},d(i){i&&H(e),Vt(r)}}}function fn(t,e){let n=[],r=[],a={};n.push({name:"__broker__",group:0});for(const i of e.cores)for(const o of i.federates){o.publications===void 0&&(o.publications=[]);for(const h of o.publications){n.push({name:`${h.federate}-${h.handle}`,federate:o.attributes.name,group:1}),h.targets===void 0&&(h.targets=[]),a[`${h.federate}-${h.handle}`]=h.key;for(const x of h.targets)r.push({source:`${h.federate}-${h.handle}`,target:`${x.federate}-${x.handle}`,label:a[`${h.federate}-${h.handle}`],ignore:!1})}}for(const i of e.cores)for(const o of i.federates){o.inputs===void 0&&(o.inputs=[]);for(const h of o.inputs){n.push({name:`${h.federate}-${h.handle}`,federate:o.attributes.name,group:2}),h.sources===void 0&&(h.sources=[]);for(const x of h.sources)r.push({source:`${x.federate}-${x.handle}`,target:`${h.federate}-${h.handle}`,label:a[`${x.federate}-${x.handle}`],ignore:!1})}}return n=Array.from(new Set(n.map(JSON.stringify))).map(JSON.parse),r=Array.from(new Set(r.map(JSON.stringify))).map(JSON.parse),{nodes:n,links:r}}function ln(t,e,n){let r;ot(t,Ut,i=>n(1,r=i));let a;return Qt(()=>{n(0,a=fn(r.graphs.federate,r.graphs.data))}),[a]}class dn extends St{constructor(e){super(),At(this,e,ln,cn,It,{})}}export{dn as default};
